{% extends "base.html" %}
{% block content %}
<section class="panel">
  <h2>Zeitplan veröffentlichen</h2>
  {% if error %}
    <p class="error">{{ error }}</p>
  {% endif %}
  {% if message %}
    <p class="success">{{ message }}</p>
  {% endif %}
  <form method="post" class="form-grid">
    <label>
      Plan auswählen
      <select name="plan_id" required>
        <option value="">-- wählen --</option>
        {% for p in saved_plans|sort(attribute='created_at', reverse=True) %}
          <option value="{{ p.id }}" {% if selected_plan_id == p.id %}selected{% endif %}>{{ p.id }} – {{ p.event_name }}</option>
        {% endfor %}
      </select>
    </label>
    <label>
      FTP-Host
      <input type="text" name="ftp_host" value="{{ ftp_host }}" placeholder="ftp.example.com">
    </label>
    <label>
      FTP-Benutzer
      <input type="text" name="ftp_user" value="{{ ftp_user }}" placeholder="user">
    </label>
    <label>
      FTP-Passwort
      <input type="password" name="ftp_password" value="{{ ftp_password }}" placeholder="pass">
    </label>
    <label>
      FTP-Pfad (optional)
      <input type="text" name="ftp_path" value="{{ ftp_path }}" placeholder="/www/zeitplan/">
    </label>
    <label>
      Dateiname
      <input type="text" name="filename" value="{{ filename or 'zeitplan.html' }}">
    </label>
    <label>
      Export-Typ
      <select name="variant">
        <option value="internal" {% if variant == 'internal' %}selected{% endif %}>Intern (mit Blöcken)</option>
        <option value="external" {% if variant == 'external' %}selected{% endif %}>Extern (nur Zeiten)</option>
      </select>
    </label>
    <div class="form-actions">
      <button type="submit" name="action" value="preview">Vorschau erzeugen</button>
      <button type="submit" name="action" value="upload">Per FTP hochladen</button>
    </div>
  </form>
</section>

{% if preview_html %}
<section class="panel">
  <h3>Vorschau</h3>
  <iframe style="width:100%; height:70vh; border:1px solid #dcdcdc;" src="data:text/html;base64,{{ preview_html }}"></iframe>
</section>
{% endif %}
{% endblock %}
